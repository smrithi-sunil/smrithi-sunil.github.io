<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Smrithi Sunil">
<meta name="dcterms.date" content="2024-11-18">
<meta name="description" content="A summary and some thoughts on the 9 episode podcast series Metascience 101 by Institute for Progress">

<title>Summary of the Metascience 101 podcast series – Smrithi Sunil</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/site_photo.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-d1b12f2568ecbe55642fee6aa00bd082.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="quarto:status" content="draft">


<link rel="stylesheet" href="../../styles.scss">
<meta name="twitter:title" content="Summary of the Metascience 101 podcast series – Smrithi Sunil">
<meta name="twitter:description" content="A summary and some thoughts on the 9 episode podcast series Metascience 101 by Institute for Progress">
<meta name="twitter:image" content="https://smrithisunil.com/posts/2024-11-18-metascience/metascience.png">
<meta name="twitter:image-height" content="900">
<meta name="twitter:image-width" content="1600">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Smrithi Sunil</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../images/SmrithiSunil_CV.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Summary of the Metascience 101 podcast series</h1>
                  <div>
        <div class="description">
          A summary and some thoughts on the 9 episode podcast series Metascience 101 by Institute for Progress
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Science</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Smrithi Sunil </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 18, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#is-science-slowing-down" id="toc-is-science-slowing-down" class="nav-link" data-scroll-target="#is-science-slowing-down">2. Is Science Slowing Down?</a></li>
  <li><a href="#the-scientific-production-function" id="toc-the-scientific-production-function" class="nav-link" data-scroll-target="#the-scientific-production-function">3. The Scientific Production Function</a></li>
  <li><a href="#arpas-fros-and-fast-grants-oh-my" id="toc-arpas-fros-and-fast-grants-oh-my" class="nav-link" data-scroll-target="#arpas-fros-and-fast-grants-oh-my">4. ARPAs, FROs, and Fast Grants, oh my!</a></li>
  <li><a href="#how-and-why-to-run-an-experiment" id="toc-how-and-why-to-run-an-experiment" class="nav-link" data-scroll-target="#how-and-why-to-run-an-experiment">5. How and Why to Run an Experiment</a></li>
  <li><a href="#safety-and-science" id="toc-safety-and-science" class="nav-link" data-scroll-target="#safety-and-science">6. Safety and Science</a></li>
  <li><a href="#science-and-political-legitimacy" id="toc-science-and-political-legitimacy" class="nav-link" data-scroll-target="#science-and-political-legitimacy">7. Science and Political Legitimacy</a></li>
  <li><a href="#invention-vs.-diffusion" id="toc-invention-vs.-diffusion" class="nav-link" data-scroll-target="#invention-vs.-diffusion">8. Invention vs.&nbsp;Diffusion</a></li>
  <li><a href="#how-to-get-involved" id="toc-how-to-get-involved" class="nav-link" data-scroll-target="#how-to-get-involved">9. How to Get Involved</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>I’ve been thinking more recently about what makes science tick, both on an individual level and on the level of teams. What motivates us? How to do good science? How to align with people who have very different goals from you? In light of the recent 2024 election and the talks of NIH reform, thinking deeply about how to do good science with the goal of improving human lives and society is more important than ever.</p>
<p>Through this search, I came across the Metascience 101 podcast series hosted by Tim Hwang and Caleb Watney from the Institute for Progress. This podcast series is essentially a “crash course in the debates, issues, and ideas driving the modern metascience movement.” I found this series to be very enjoyable and thought-provoking. Here, I share a summary of each episode and some of my own thoughts on the topics discussed. For context, roots of Progress, founded by Caleb Watney and Alec Stapp, is a think tank focused on innovation policy in Washington D.C.</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1. Introduction</h2>
<p><strong>Why should the government be in the business of science?</strong></p>
<p>Science is a public good. Scientific and technological advancements make the world a better place and improve outcomes for society.</p>
<p>The US Federal Government, which includes the National Institute of Health (NIH) and the National Science Foundation (NSF), is the single largest funder of basic scientific research in the world, with a combined ~$60 billion a year. The NSF is more focused on funding basic research, while the NIH is more focused on funding applied biomedical research, although both fund basic and applied research to some degree. There are of course other funders to consider, such as private sector labs and philanthropic organizations.</p>
<p>If we think of science as a public good, it makes sense for the government to intervene. A private lab on its own would under-provide research to the level we might want in society - the large overhead costs for research, safety and efficacy, and manufacturing, would be difficult to recoup. To incentivize the private market to invest in research the government has some policies in place, such as tax-subsidies and patents. However, the bulk of basic research occurs at universities and moves to the private sector when it gets closer to commercialization.</p>
<p>The patent system is interesting in that it leads to some areas of research getting large investments and other areas getting very little. Given that every drug basically gets 20 years of patent protection, and you need to file a patent before the start of clinical trials, research areas where time from the start of a clinical trial to market is short get a lot more investment since there would be more time left on the patent clock. While research areas that have long clinical trials, often 12-16 years before a drug can reach consumers, are less likely to receive investments. So, there is a whole area of that is being under-invested in relative to the life years that could be saved. There is a mismatch here between existing policies and accelerating innovation.</p>
<p>Figure: research area and length of clinical trials??</p>
<p><strong>What types of funding systems are there?</strong></p>
<p>So, it’s valuable for the government to incentivize and enable more research than what the private sector would do. There are a few different models for funding, which individual labs or organizations can apply for, some more dominant than others. Below I outline the high-level ideas for how funding works. To note, these are just a few different ideas that have been proposed and tested out to various degrees. The bulk of NIH and NSF funding is distributed through the traditional peer-review process.</p>
<p><strong><em>Traditional peer-review.</em></strong> This is by far the most dominant model for research funding. On a very high-level, scientists who are principle investigators develop and submit proposals for research directions they want to work on. A panel of their peers (other principle investigators) review their proposal and provide a score across multiple dimensions: significance of the work, experience of the principle investigator, how innovative is the research, the approach, and the environment in which the research will be conducted. The Program Officers at NIH or NSF will combine the peer-review feedback and create a rough ranking based on the score provided with some discretion on their part about rank order. This approach is largely funded based on the average opinion of your peers about the research proposal. The peer-review process can be long and require the investigator to iterate and submit the proposal multiple times until it gets a good enough score. The average time to get this type of grant funded is roughly 18 months.</p>
<p><strong><em>Person-based funding.</em></strong> In this approach, you choose a scientist whose entire research agenda seems promising and fund the person instead of one particular project. This gives the individual scientist a lot of freedom to decide what research to pursue. The Howard Hughes Medical Institute is an example of person-based funding where an individual receives funding for a specific number of years, based on career level, and is usually renewable for a second term. The Arc Institute is another example of person-based funding for a couple of universities in the Bay Area. Other institutes, including the NSF, have career awards that also fund the person and not a specific research project.</p>
<p><strong><em>Golden ticket.</em></strong> Consensus-oriented review processes, such as peer-review, often end up biasing against high-risk, high-reward research. A long-standing critique of NIH funding is that it is too risk averse. If some reviewers really like a novel idea and some don’t, the proposal either ends up rejected or modified significantly to appease the entire review panel. So maybe we should be looking at variation across reviewers? A golden ticket idea gives each reviewer a one-time ticket to champion a particular idea that they think is really promising and want to see funded. This idea should certainly not replace all existing funding strategies, but be part of a repertoire of funding strategies to perform the best research.</p>
<p><strong><em>Lottery.</em></strong> How can we know if our review processes are actually selecting the most promising research ideas? Perhaps above some minimum threshold, we’d be better off choosing proposals at random. How much better does the extensive review process do over random chance? Grant writing and re-writing take huge amounts of time and effort that could otherwise go to actually doing the science. If a small portion of funding is provided through a lottery, we can gather evidence about how well different kinds of funding strategies do over random chance.</p>
<p>Figure: how much funding comes from each type of grant??</p>
<p><strong>What does funding look like for an individual scientist?</strong></p>
<p>At the PhD level, in the sciences, you are generally fully funded as a student.</p>
</section>
<section id="is-science-slowing-down" class="level2">
<h2 class="anchored" data-anchor-id="is-science-slowing-down">2. Is Science Slowing Down?</h2>
</section>
<section id="the-scientific-production-function" class="level2">
<h2 class="anchored" data-anchor-id="the-scientific-production-function">3. The Scientific Production Function</h2>
</section>
<section id="arpas-fros-and-fast-grants-oh-my" class="level2">
<h2 class="anchored" data-anchor-id="arpas-fros-and-fast-grants-oh-my">4. ARPAs, FROs, and Fast Grants, oh my!</h2>
</section>
<section id="how-and-why-to-run-an-experiment" class="level2">
<h2 class="anchored" data-anchor-id="how-and-why-to-run-an-experiment">5. How and Why to Run an Experiment</h2>
</section>
<section id="safety-and-science" class="level2">
<h2 class="anchored" data-anchor-id="safety-and-science">6. Safety and Science</h2>
</section>
<section id="science-and-political-legitimacy" class="level2">
<h2 class="anchored" data-anchor-id="science-and-political-legitimacy">7. Science and Political Legitimacy</h2>
</section>
<section id="invention-vs.-diffusion" class="level2">
<h2 class="anchored" data-anchor-id="invention-vs.-diffusion">8. Invention vs.&nbsp;Diffusion</h2>
</section>
<section id="how-to-get-involved" class="level2">
<h2 class="anchored" data-anchor-id="how-to-get-involved">9. How to Get Involved</h2>


</section>

<script data-collect-dnt="true" async="" defer="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/smrithisunil\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>